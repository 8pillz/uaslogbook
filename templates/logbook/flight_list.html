{% extends "base.html" %}

{% block title %}Flights – UAS Logbook{% endblock %}

{% block content %}
<div class="app-actions">
    <div class="app-actions-left">
        <div class="app-actions-title">Flights</div>
        <div class="app-actions-sub">
            Your personal UAS flight logbook.
        </div>
    </div>
    <div class="app-actions-right">
        <a href="{% url 'flight_import' %}" class="btn btn-secondary">Import CSV</a>
        <a href="{% url 'flight_export_csv' %}" class="btn btn-ghost">Export CSV</a>
        <a href="{% url 'flight_create' %}" class="btn btn-primary">New flight</a>
    </div>
</div>

<div class="form-card">
    <form method="get" class="form-section">
        <div class="form-section-title">Filters</div>
        <div class="form-section-grid">
            <div class="form-field">
                <label class="form-label">From date</label>
                <input type="date" name="start" value="{{ request.GET.start }}">
            </div>
            <div class="form-field">
                <label class="form-label">To date</label>
                <input type="date" name="end" value="{{ request.GET.end }}">
            </div>
            <div class="form-field">
                <label class="form-label">UAV config</label>
                <select name="uav">
                    <option value="">Any</option>
                    <option value="MULTI" {% if request.GET.uav == "MULTI" %}selected{% endif %}>Multirotor</option>
                    <option value="FIXED" {% if request.GET.uav == "FIXED" %}selected{% endif %}>Fixed-wing</option>
                    <option value="HELI" {% if request.GET.uav == "HELI" %}selected{% endif %}>Helicopter</option>
                    <option value="VTOL" {% if request.GET.uav == "VTOL" %}selected{% endif %}>VTOL / hybrid</option>
                    <option value="OTHER" {% if request.GET.uav == "OTHER" %}selected{% endif %}>Other</option>
                </select>
            </div>
            <div class="form-field">
                <label class="form-label">Role</label>
                <select name="role">
                    <option value="">Any</option>
                    <option value="PIC" {% if request.GET.role == "PIC" %}selected{% endif %}>Pilot in Command</option>
                    <option value="COP" {% if request.GET.role == "COP" %}selected{% endif %}>Co-pilot</option>
                    <option value="OBS" {% if request.GET.role == "OBS" %}selected{% endif %}>Observer / VO</option>
                    <option value="STU" {% if request.GET.role == "STU" %}selected{% endif %}>Student</option>
                    <option value="INS" {% if request.GET.role == "INS" %}selected{% endif %}>Instructor</option>
                    <option value="EXM" {% if request.GET.role == "EXM" %}selected{% endif %}>Examiner</option>
                    <option value="OTH" {% if request.GET.role == "OTH" %}selected{% endif %}>Other</option>
                </select>
            </div>
            <div class="form-field" style="align-self:flex-end;">
                <button type="submit" class="btn btn-secondary">Apply</button>
            </div>
        </div>
    </form>
</div>

<div class="form-card">
    <div class="form-section">
        <div class="form-section-title">Summary</div>
        <div class="totals-card">
            <div class="total-item">
                <div class="total-label">Total flights</div>
                <div class="total-value">{{ flights|length }}</div>
            </div>
            <div class="total-item">
                <div class="total-label">Total flight time (min)</div>
                <div class="total-value">
                    {{ total_flight_time|default:0 }}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="table-wrapper">
    <table class="flight-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>UAV</th>
                <th>Route</th>
                <th>Role</th>
                <th>Dep</th>
                <th>Arr</th>
                <th>Flight (min)</th>
                <th>TO (D/N)</th>
                <th>LDG (D/N)</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        {% for flight in flights %}
            <tr>
                <td>{{ flight.date }}</td>
                <td>{{ flight.get_uav_type_display }} {{ flight.uav_model }}</td>
                <td>{{ flight.departure }} → {{ flight.arrival }}</td>
                <td>{{ flight.get_pilot_role_display }}</td>
                <td>{{ flight.off_block }}</td>
                <td>{{ flight.on_block }}</td>
                <td>{{ flight.flight_time }}</td>
                <td>{{ flight.takeoff_day }}/{{ flight.takeoff_night }}</td>
                <td>{{ flight.landing_day }}/{{ flight.landing_night }}</td>
                <td>
                    <a href="{% url 'flight_edit' flight.pk %}" class="btn btn-ghost">Edit</a>
                    <a href="{% url 'flight_delete' flight.pk %}" class="btn btn-ghost">Delete</a>
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="10">No flights logged yet. Use “New flight” to add one.</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
